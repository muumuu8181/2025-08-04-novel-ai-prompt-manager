<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novel AI ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        .version-badge {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
        }

        .header {
            background: linear-gradient(90deg, #4A90E2 0%, #7B68EE 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .prompt-input-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .title-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .title-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: border-color 0.3s;
        }

        .title-input:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .character-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .input-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .input-section h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .main-prompt-section {
            grid-column: 1;
        }

        .main-prompt-section h3 {
            font-size: 1.2rem;
            color: #4A90E2;
        }

        .character-section {
            position: relative;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .main-prompt {
            min-height: 120px;
        }

        .character-prompt {
            min-height: 80px;
        }

        textarea:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .copy-btn {
            margin-top: 8px;
            padding: 6px 12px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .tags-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tags-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tag-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .tag-input:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .add-tag-btn {
            padding: 8px 16px;
            background: linear-gradient(45deg, #17a2b8, #6f42c1);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .existing-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag-item {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #bbdefb;
        }

        .tag-item:hover {
            background: #1976d2;
            color: white;
        }

        .tag-item.selected {
            background: #4A90E2;
            color: white;
            border-color: #4A90E2;
        }

        .current-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .current-tag {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .remove-tag {
            cursor: pointer;
            font-weight: bold;
        }

        .search-filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }

        .search-input {
            flex: 2;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .tag-filter {
            flex: 1;
        }

        .tag-filter select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4A90E2, #7B68EE);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #6f42c1);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .main-content {
            padding: 20px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .stat-item {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4A90E2;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .prompt-list {
            display: grid;
            gap: 20px;
        }

        .prompt-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .prompt-item:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prompt-date {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .prompt-tags {
            display: flex;
            gap: 6px;
        }

        .prompt-content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .prompt-summary {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4A90E2;
            margin-bottom: 10px;
        }

        .prompt-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .prompt-preview {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .prompt-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4A90E2;
            line-height: 1.6;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 13px;
        }

        .character-content {
            border-left-color: #28a745;
        }

        .prompt-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            min-width: 80px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .search-highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .file-input-section {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .file-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .prompt-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }


        @media (max-width: 768px) {
            .character-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .search-filter-section {
                flex-direction: column;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .stats {
                flex-direction: column;
                align-items: center;
            }
            
            .version-badge {
                top: 10px;
                right: 15px;
                font-size: 0.75rem;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="version-badge">v0.23</div>
        <div class="header">
            <h1>ğŸ¨ Novel AI ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã‚¢ãƒ—ãƒª</h1>
            <p>è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¯¾å¿œãƒ»ã‚¿ã‚°ä»˜ãé«˜åº¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="controls">
            <!-- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="title-section">
                <h3>ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚¤ãƒˆãƒ«</h3>
                <input type="text" id="promptTitle" class="title-input" placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä»˜ã‘ã¦ãã ã•ã„ï¼ˆä¾‹: æ£®ã®ä¸­ã®ç¾å°‘å¥³ã€æˆ¦é—˜ã‚·ãƒ¼ãƒ³ãªã©ï¼‰" maxlength="50">
            </div>

            <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="prompt-input-grid">
                <div class="input-section main-prompt-section">
                    <h3>ğŸŒŸ ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h3>
                    <textarea id="mainPrompt" class="main-prompt" placeholder="èƒŒæ™¯ã€è¨­å®šã€å“è³ªæŒ‡å®šãªã©...&#10;&#10;ä¾‹ï¼š&#10;beautiful landscape, detailed background, high quality, masterpiece, 8k resolution, studio lighting"></textarea>
                    <button onclick="copyIndividualPrompt('main')" class="copy-btn">ğŸ“‹ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼</button>
                </div>
                
                <div class="character-grid">
                    <div class="input-section character-section">
                        <h3>ğŸ‘¤ 1äººç›®</h3>
                        <textarea id="character1" class="character-prompt" placeholder="1äººç›®ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è©³ç´°...&#10;&#10;ä¾‹ï¼š&#10;anime girl, long blue hair, green eyes, school uniform"></textarea>
                        <button onclick="copyIndividualPrompt('char1')" class="copy-btn">ğŸ“‹ 1äººç›®ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    
                    <div class="input-section character-section">
                        <h3>ğŸ‘¥ 2äººç›®</h3>
                        <textarea id="character2" class="character-prompt" placeholder="2äººç›®ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è©³ç´°...&#10;&#10;ä¾‹ï¼š&#10;anime boy, short black hair, brown eyes, casual clothes"></textarea>
                        <button onclick="copyIndividualPrompt('char2')" class="copy-btn">ğŸ“‹ 2äººç›®ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    
                    <div class="input-section character-section">
                        <h3>ğŸ‘¥+ 3ã€œ6äººç›®</h3>
                        <textarea id="character3to6" class="character-prompt" placeholder="3ã€œ6äººç›®ã®è¿½åŠ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼...&#10;&#10;ä¾‹ï¼š&#10;background characters, crowd, various people"></textarea>
                        <button onclick="copyIndividualPrompt('char3to6')" class="copy-btn">ğŸ“‹ 3ã€œ6äººç›®ã‚³ãƒ”ãƒ¼</button>
                    </div>
                </div>
            </div>

            <!-- ã‚¿ã‚°ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="tags-section">
                <h3>ğŸ·ï¸ ã‚¿ã‚°ç®¡ç†</h3>
                <div class="tags-input-group">
                    <input type="text" id="tagInput" class="tag-input" placeholder="æ–°ã—ã„ã‚¿ã‚°ã‚’å…¥åŠ›... (ä¾‹: ç”·æ€§, å¥³æ€§, æ£®ã®ä¸­, å¤œ)">
                    <button onclick="addTag()" class="add-tag-btn">â• ã‚¿ã‚°è¿½åŠ </button>
                </div>
                
                <div class="existing-tags" id="existingTags">
                    <!-- æ—¢å­˜ã‚¿ã‚°ãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                
                <div class="current-tags" id="currentTags">
                    <!-- ç¾åœ¨é¸æŠä¸­ã®ã‚¿ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div class="search-filter-section">
                <div style="flex: 2;">
                    <h4>ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</h4>
                    <input type="text" id="searchInput" class="search-input" placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã§æ¤œç´¢...">
                </div>
                <div class="tag-filter">
                    <h4>ğŸ·ï¸ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h4>
                    <select id="tagFilter">
                        <option value="">å…¨ã¦ã®ã‚¿ã‚°</option>
                    </select>
                </div>
                <div class="file-input-section">
                    <h4>ğŸ“ å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«</h4>
                    <input type="file" id="fileInput" class="file-input" accept=".txt" multiple>
                    <button onclick="loadExternalFiles()" class="btn-info btn-small">èª­ã¿è¾¼ã¿</button>
                </div>
            </div>

            <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
            <div class="button-group">
                <button onclick="savePrompt()" class="btn-primary">ğŸ’¾ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜</button>
                <button onclick="saveFromClipboard()" class="btn-secondary">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ä¿å­˜</button>
                <button onclick="exportData()" class="btn-info">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button onclick="importData()" class="btn-info">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button onclick="clearAll()" class="btn-secondary">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
            </div>
        </div>

        <div class="main-content">
            <!-- çµ±è¨ˆè¡¨ç¤º -->
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">ç·ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="searchCount">0</div>
                    <div class="stat-label">æ¤œç´¢çµæœ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="todayCount">0</div>
                    <div class="stat-label">ä»Šæ—¥è¿½åŠ </div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="tagCount">0</div>
                    <div class="stat-label">ã‚¿ã‚°æ•°</div>
                </div>
            </div>

            <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸€è¦§ -->
            <div id="promptList" class="prompt-list">
                <div class="empty-state">
                    <h3>ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h3>
                    <p>æœ€åˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let prompts = [];
        let allTags = new Set();
        let currentTags = new Set();
        let currentSearch = '';
        let currentTagFilter = '';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            loadPrompts();
            displayPrompts();
            updateStats();
            updateTagsDisplay();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            document.getElementById('searchInput').addEventListener('input', function() {
                currentSearch = this.value;
                displayPrompts();
            });
            
            document.getElementById('tagFilter').addEventListener('change', function() {
                currentTagFilter = this.value;
                displayPrompts();
            });
            
            document.getElementById('tagInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTag();
                }
            });
        };

        // å€‹åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚³ãƒ”ãƒ¼
        async function copyIndividualPrompt(type) {
            let content = '';
            
            switch(type) {
                case 'main':
                    content = document.getElementById('mainPrompt').value.trim();
                    break;
                case 'char1':
                    content = document.getElementById('character1').value.trim();
                    break;
                case 'char2':
                    content = document.getElementById('character2').value.trim();
                    break;
                case 'char3to6':
                    content = document.getElementById('character3to6').value.trim();
                    break;
            }
            
            if (!content) {
                alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(content);
                showNotification(`${getPromptTypeName(type)}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼`);
            } catch (err) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function getPromptTypeName(type) {
            const names = {
                'main': 'ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
                'char1': '1äººç›®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼',
                'char2': '2äººç›®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼',
                'char3to6': '3ã€œ6äººç›®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼'
            };
            return names[type] || type;
        }

        // ã‚¿ã‚°ã®è¿½åŠ 
        function addTag() {
            const input = document.getElementById('tagInput');
            const tagName = input.value.trim();
            
            if (!tagName) return;
            
            currentTags.add(tagName);
            allTags.add(tagName);
            
            input.value = '';
            updateTagsDisplay();
        }

        // ã‚¿ã‚°è¡¨ç¤ºã®æ›´æ–°
        function updateTagsDisplay() {
            // æ—¢å­˜ã‚¿ã‚°ä¸€è¦§ã®æ›´æ–°
            const existingTagsContainer = document.getElementById('existingTags');
            existingTagsContainer.innerHTML = Array.from(allTags).map(tag => 
                `<span class="tag-item ${currentTags.has(tag) ? 'selected' : ''}" onclick="toggleTag('${tag}')">${tag}</span>`
            ).join('');
            
            // ç¾åœ¨é¸æŠä¸­ã‚¿ã‚°ã®æ›´æ–°
            const currentTagsContainer = document.getElementById('currentTags');
            currentTagsContainer.innerHTML = Array.from(currentTags).map(tag => 
                `<span class="current-tag">${tag} <span class="remove-tag" onclick="removeCurrentTag('${tag}')">Ã—</span></span>`
            ).join('');
            
            // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®æ›´æ–°
            const tagFilter = document.getElementById('tagFilter');
            const currentValue = tagFilter.value;
            tagFilter.innerHTML = '<option value="">å…¨ã¦ã®ã‚¿ã‚°</option>' + 
                Array.from(allTags).map(tag => 
                    `<option value="${tag}" ${currentValue === tag ? 'selected' : ''}>${tag}</option>`
                ).join('');
        }

        // ã‚¿ã‚°ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleTag(tagName) {
            if (currentTags.has(tagName)) {
                currentTags.delete(tagName);
            } else {
                currentTags.add(tagName);
            }
            updateTagsDisplay();
        }

        // ç¾åœ¨ã®ã‚¿ã‚°ã‚’å‰Šé™¤
        function removeCurrentTag(tagName) {
            currentTags.delete(tagName);
            updateTagsDisplay();
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¿å­˜
        function savePrompt() {
            const title = document.getElementById('promptTitle').value.trim();
            const mainPrompt = document.getElementById('mainPrompt').value.trim();
            
            if (!title) {
                alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!mainPrompt) {
                alert('ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const prompt = {
                id: Date.now(),
                title: title,
                mainPrompt: mainPrompt,
                character1: document.getElementById('character1').value.trim(),
                character2: document.getElementById('character2').value.trim(),
                character3to6: document.getElementById('character3to6').value.trim(),
                tags: Array.from(currentTags),
                timestamp: new Date(),
                source: 'manual'
            };

            prompts.unshift(prompt);
            
            // ã‚¿ã‚°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã«è¿½åŠ 
            currentTags.forEach(tag => allTags.add(tag));
            
            savePrompts();
            clearInputs();
            displayPrompts();
            updateStats();
            updateTagsDisplay();
            
            showNotification('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼');
        }

        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¯ãƒªã‚¢
        function clearInputs() {
            document.getElementById('promptTitle').value = '';
            document.getElementById('mainPrompt').value = '';
            document.getElementById('character1').value = '';
            document.getElementById('character2').value = '';
            document.getElementById('character3to6').value = '';
            currentTags.clear();
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ä¿å­˜
        async function saveFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                if (!text.trim()) {
                    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ãŒç©ºã§ã™');
                    return;
                }

                const prompt = {
                    id: Date.now(),
                    title: text.trim().substring(0, 30) + (text.length > 30 ? '...' : ''),
                    mainPrompt: text.trim(),
                    character1: '',
                    character2: '',
                    character3to6: '',
                    tags: Array.from(currentTags),
                    timestamp: new Date(),
                    source: 'clipboard'
                };

                prompts.unshift(prompt);
                
                currentTags.forEach(tag => allTags.add(tag));
                
                savePrompts();
                displayPrompts();
                updateStats();
                
                showNotification('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            } catch (err) {
                alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®èª­ã¿å–ã‚Šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¡¨ç¤º
        function displayPrompts() {
            const container = document.getElementById('promptList');
            const filteredPrompts = filterPrompts();

            if (filteredPrompts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ğŸ” ${currentSearch || currentTagFilter ? 'æ¤œç´¢çµæœãªã—' : 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã‚ã‚Šã¾ã›ã‚“'}</h3>
                        <p>${currentSearch || currentTagFilter ? 'æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' : 'æœ€åˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„'}</p>
                    </div>
                `;
                updateStats();
                return;
            }

            container.innerHTML = filteredPrompts.map(prompt => `
                <div class="prompt-item">
                    <div class="prompt-header">
                        <div class="prompt-date">
                            ğŸ“… ${formatDateTime(prompt.timestamp)} 
                            ${prompt.source === 'clipboard' ? 'ğŸ“‹' : prompt.source === 'file' ? 'ğŸ“' : 'âœï¸'}
                        </div>
                        <div class="prompt-tags">
                            ${prompt.tags.map(tag => `<span class="tag-item">${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="prompt-summary">
                        <div class="prompt-title">${highlightSearch(prompt.title || 'ç„¡é¡Œ')}</div>
                        <div class="prompt-preview">${highlightSearch(truncateText(prompt.mainPrompt, 30))}</div>
                    </div>
                    
                    <div class="prompt-actions">
                        <button onclick="restorePromptToInputs('${prompt.id}')" class="btn-primary btn-small">ğŸ“ å…¥åŠ›æ¬„ã«å¾©å…ƒ</button>
                        <button onclick="copyStoredPrompt('${prompt.id}', 'main')" class="btn-secondary btn-small">ğŸ“‹ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼</button>
                        <button onclick="deletePrompt('${prompt.id}')" class="btn-info btn-small">ğŸ—‘ï¸ å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');

            updateStats();
        }

        // ä¿å­˜æ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚³ãƒ”ãƒ¼
        async function copyStoredPrompt(id, type) {
            const prompt = prompts.find(p => p.id == id);
            if (!prompt) return;

            let content = '';
            switch(type) {
                case 'main':
                    content = prompt.mainPrompt;
                    break;
                case 'char1':
                    content = prompt.character1;
                    break;
                case 'char2':
                    content = prompt.character2;
                    break;
                case 'char3to6':
                    content = prompt.character3to6;
                    break;
            }

            if (!content.trim()) {
                alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            try {
                await navigator.clipboard.writeText(content);
                showNotification(`${getPromptTypeName(type)}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼`);
            } catch (err) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterPrompts() {
            let filtered = prompts;

            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
            if (currentSearch.trim()) {
                const searchTerm = currentSearch.toLowerCase();
                filtered = filtered.filter(prompt => 
                    (prompt.title && prompt.title.toLowerCase().includes(searchTerm)) ||
                    prompt.mainPrompt.toLowerCase().includes(searchTerm) ||
                    prompt.character1.toLowerCase().includes(searchTerm) ||
                    prompt.character2.toLowerCase().includes(searchTerm) ||
                    prompt.character3to6.toLowerCase().includes(searchTerm) ||
                    prompt.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
            }

            // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            if (currentTagFilter) {
                filtered = filtered.filter(prompt => 
                    prompt.tags.includes(currentTagFilter)
                );
            }

            return filtered;
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã®åˆ‡ã‚Šè©°ã‚
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›æ¬„ã«å¾©å…ƒ
        function restorePromptToInputs(id) {
            const prompt = prompts.find(p => p.id == id);
            if (!prompt) return;
            
            // å„å…¥åŠ›æ¬„ã«å€¤ã‚’è¨­å®š
            document.getElementById('promptTitle').value = prompt.title || '';
            document.getElementById('mainPrompt').value = prompt.mainPrompt || '';
            document.getElementById('character1').value = prompt.character1 || '';
            document.getElementById('character2').value = prompt.character2 || '';
            document.getElementById('character3to6').value = prompt.character3to6 || '';
            
            // ã‚¿ã‚°ã‚‚å¾©å…ƒ
            currentTags.clear();
            if (prompt.tags) {
                prompt.tags.forEach(tag => currentTags.add(tag));
            }
            updateTagsDisplay();
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showNotification(`"${prompt.title || 'ç„¡é¡Œ'}" ã‚’å…¥åŠ›æ¬„ã«å¾©å…ƒã—ã¾ã—ãŸï¼`);
            
            // å…¥åŠ›ã‚¨ãƒªã‚¢ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.querySelector('.title-section').scrollIntoView({ behavior: 'smooth' });
        }

        // æ¤œç´¢èªå¥ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function highlightSearch(content) {
            if (!currentSearch.trim() || !content) {
                return content || '';
            }

            const regex = new RegExp(`(${currentSearch})`, 'gi');
            return content.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å‰Šé™¤
        function deletePrompt(id) {
            if (!confirm('ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            prompts = prompts.filter(p => p.id != id);
            savePrompts();
            displayPrompts();
            updateStats();
            
            showNotification('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // çµ±è¨ˆã®æ›´æ–°
        function updateStats() {
            const total = prompts.length;
            const filtered = filterPrompts().length;
            const today = prompts.filter(p => {
                const promptDate = new Date(p.timestamp);
                const todayDate = new Date();
                return promptDate.toDateString() === todayDate.toDateString();
            }).length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('searchCount').textContent = filtered;
            document.getElementById('todayCount').textContent = today;
            document.getElementById('tagCount').textContent = allTags.size;
        }

        // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
        function loadExternalFiles() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;

            if (files.length === 0) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            let loadedCount = 0;
            Array.from(files).forEach(file => {
                if (file.type !== 'text/plain') {
                    alert(`${file.name} ã¯ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result.trim();
                    if (content) {
                        const prompt = {
                            id: Date.now() + Math.random(),
                            title: file.name.replace('.txt', '') || content.substring(0, 30) + '...',
                            mainPrompt: content,
                            character1: '',
                            character2: '',
                            character3to6: '',
                            tags: [],
                            timestamp: new Date(),
                            source: 'file',
                            filename: file.name
                        };

                        prompts.unshift(prompt);
                        loadedCount++;
                        
                        if (loadedCount === files.length) {
                            savePrompts();
                            displayPrompts();
                            updateStats();
                            showNotification(`${loadedCount}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
                        }
                    }
                };
                reader.readAsText(file, 'UTF-8');
            });

            fileInput.value = '';
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            if (prompts.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const exportData = {
                prompts: prompts,
                tags: Array.from(allTags),
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `novel_ai_prompts_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (importedData.prompts && Array.isArray(importedData.prompts)) {
                            prompts = [...importedData.prompts, ...prompts];
                            
                            if (importedData.tags && Array.isArray(importedData.tags)) {
                                importedData.tags.forEach(tag => allTags.add(tag));
                            }
                            
                            savePrompts();
                            displayPrompts();
                            updateStats();
                            updateTagsDisplay();
                            showNotification(`${importedData.prompts.length}å€‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼`);
                        } else {
                            alert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
                        }
                    } catch (err) {
                        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤
        function clearAll() {
            if (!confirm('å…¨ã¦ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
            
            prompts = [];
            allTags.clear();
            currentTags.clear();
            savePrompts();
            displayPrompts();
            updateStats();
            updateTagsDisplay();
            showNotification('å…¨ã¦ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆlocalStorageï¼‰
        function savePrompts() {
            const saveData = {
                prompts: prompts,
                tags: Array.from(allTags)
            };
            localStorage.setItem('novel_ai_prompts', JSON.stringify(saveData));
        }

        // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆlocalStorageï¼‰
        function loadPrompts() {
            const saved = localStorage.getItem('novel_ai_prompts');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    if (data.prompts) {
                        prompts = data.prompts;
                        // æ—¥æ™‚ã®æ–‡å­—åˆ—ã‚’Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                        prompts.forEach(prompt => {
                            if (typeof prompt.timestamp === 'string') {
                                prompt.timestamp = new Date(prompt.timestamp);
                            }
                            // å¤ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã®äº’æ›æ€§
                            if (!prompt.character1) {
                                prompt.character1 = '';
                                prompt.character2 = '';
                                prompt.character3to6 = '';
                                prompt.mainPrompt = prompt.content || '';
                            }
                            if (!prompt.tags) {
                                prompt.tags = [];
                            }
                            // ã‚¿ã‚¤ãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ï¼ˆV0.21ä»¥é™ï¼‰
                            if (!prompt.title) {
                                prompt.title = prompt.mainPrompt ? 
                                    truncateText(prompt.mainPrompt, 30) : 'ç„¡é¡Œ';
                            }
                        });
                    }
                    
                    if (data.tags) {
                        allTags = new Set(data.tags);
                    }
                } catch (err) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                    prompts = [];
                    allTags = new Set();
                }
            }
        }

        // æ—¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDateTime(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hour = String(d.getHours()).padStart(2, '0');
            const minute = String(d.getMinutes()).padStart(2, '0');
            return `${year}/${month}/${day} ${hour}:${minute}`;
        }

        // é€šçŸ¥ã®è¡¨ç¤º
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSï¼ˆå‹•çš„ã«è¿½åŠ ï¼‰
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>